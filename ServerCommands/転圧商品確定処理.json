{
  "Enabled": true,
  "Triggers": [
    {
      "$type": "Forguncy.ServerCommands.Models.PostRequestTrigger, ServerDesignerCommon",
      "Permission": {
        "AllowRoles": [
          "FGC_LoginUser"
        ]
      },
      "Parameters": [
        {
          "Name": "P_転圧ID"
        }
      ]
    }
  ],
  "Commands": [
    {
      "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
      "ParameterName": "転圧計上商品ID",
      "TableValue": {
        "TableName": "m_product",
        "OnlyGetValue": true,
        "TableValueType": 0,
        "BindingInfos": [
          {
            "BindingInfo": {
              "TableName": "m_product",
              "ColumnName": "product_id"
            },
            "ColumnName": "product_id"
          }
        ],
        "SqlCondition": {
          "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
          "ColumnBindingInfo": {
            "TableName": "m_product",
            "ColumnName": "compaction_account_product_flg"
          },
          "Value": "1"
        }
      },
      "ID": "209ab9207c5e44859d0aa2a2ea6831a5"
    },
    {
      "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
      "ParameterName": "転圧商品",
      "TableValue": {
        "TableName": "t_object_product",
        "BindingInfos": [
          {
            "BindingInfo": {
              "TableName": "t_object_product",
              "ColumnName": "object_product_id"
            },
            "ColumnName": "物件商品ID"
          },
          {
            "BindingInfo": {
              "TableName": "t_object_product",
              "ColumnName": "product_id"
            },
            "ColumnName": "商品ID"
          },
          {
            "BindingInfo": {
              "TableName": "t_object_product",
              "ColumnName": "remarks"
            },
            "ColumnName": "備考"
          },
          {
            "BindingInfo": {
              "TableName": "t_object_product",
              "ColumnName": "compaction_id",
              "RelationBinding": {
                "RelatedTable": "t_object_compaction",
                "RelatedColumn": "compaction_id",
                "DisplayColumn": "compaction_type"
              }
            },
            "ColumnName": "転圧区分"
          },
          {
            "BindingInfo": {
              "TableName": "t_object_product",
              "ColumnName": "compaction_id",
              "RelationBinding": {
                "RelatedTable": "t_object_compaction",
                "RelatedColumn": "compaction_id",
                "DisplayColumn": "compaction_enforce_enddate"
              }
            },
            "ColumnName": "転圧実施終了日"
          }
        ],
        "SqlCondition": {
          "$type": "ForguncyDataAccess.RelationSqlCondition, ForguncyDataAccess",
          "Condition1": {
            "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
            "ColumnBindingInfo": {
              "TableName": "t_object_product",
              "ColumnName": "compaction_id"
            },
            "Value": {
              "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
              "SerializeProperty": "=P_転圧ID"
            }
          },
          "Condition2": {
            "$type": "ForguncyDataAccess.RelationSqlCondition, ForguncyDataAccess",
            "Condition1": {
              "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
              "ColumnBindingInfo": {
                "TableName": "t_object_product",
                "ColumnName": "sales_account_complete_flg"
              },
              "Value": "0",
              "LeftBracket": 1
            },
            "Condition2": {
              "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
              "ColumnBindingInfo": {
                "TableName": "t_object_product",
                "ColumnName": "purchase_account_complete_flg"
              },
              "Value": "0",
              "RightBracket": 1
            },
            "RelationType": 1
          }
        }
      },
      "ID": "a453a123f9fa4b51ab58d4bfd568a1e6"
    },
    {
      "$type": "Forguncy.Model.LoopCommand, ServerDesignerCommon",
      "LoopInfo": {
        "$type": "Forguncy.Model.CountLoopInfo, ServerDesignerCommon",
        "LoopCount": {
          "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
          "SerializeProperty": "=転圧商品"
        },
        "LoopItemParamName": "Item"
      },
      "CommandList": [
        {
          "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
          "ConditionAndCommandPairList": [
            {
              "Condition": {
                "$type": "ForguncyDataAccess.RelationSqlCondition, ForguncyDataAccess",
                "Condition1": {
                  "$type": "ForguncyDataAccess.RelationSqlCondition, ForguncyDataAccess",
                  "Condition1": {
                    "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                    "param": {
                      "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                      "ParamObject": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=Item.転圧区分"
                      }
                    },
                    "value": "1"
                  },
                  "Condition2": {
                    "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                    "param": {
                      "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                      "ParamObject": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=Item.商品ID"
                      }
                    },
                    "value": {
                      "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                      "SerializeProperty": "=転圧計上商品ID"
                    }
                  }
                },
                "Condition2": {
                  "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                  "param": {
                    "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                    "ParamObject": {
                      "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                      "SerializeProperty": "=Item.備考"
                    }
                  },
                  "value": "%Null%"
                }
              },
              "CommandList": [
                {
                  "$type": "Forguncy.Model.Commands.SetParameterCommand, ServerDesignerCommon",
                  "ParameterName": "転圧備考",
                  "ParameterValue": {
                    "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                    "SerializeProperty": "=\"施工完了日：\"&TEXT(Item.転圧実施終了日,\"yyyy/mm/dd\")"
                  },
                  "ID": "7341c5fd54e3464e942d143dcf58d913"
                },
                {
                  "$type": "Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon",
                  "TableName": "t_object_product",
                  "ShowConfirm": false,
                  "ConfirmText": "本当に更新してもよろしいですか？",
                  "RowsToUpdate": 1,
                  "RowsToUpdateCondition": {
                    "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
                    "ColumnBindingInfo": {
                      "TableName": "t_object_product",
                      "ColumnName": "object_product_id"
                    },
                    "Value": {
                      "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                      "SerializeProperty": "=Item.物件商品ID"
                    }
                  },
                  "UpdateValues": [
                    {
                      "ColumnName": "remarks",
                      "Value": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=転圧備考"
                      }
                    }
                  ]
                }
              ],
              "ID": "77d6568f-c1a5-4859-82f8-da4491559cfa"
            }
          ],
          "Comments": "自社施工、転圧計上商品、備考無の場合"
        },
        {
          "$type": "Forguncy.Model.RequestServerCommand, ServerDesignerCommon",
          "ServerCommandName": "計上確定可能フラグ取得処理",
          "Parameters": [
            {
              "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
              "Value": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=Item.物件商品ID"
              },
              "ParamName": "P_物件商品ID"
            }
          ],
          "ReturnPropertiesTo": [
            {
              "ResultPropertyName": "R_売上計上確定可能フラグ",
              "ResultTo": {
                "SerializeProperty": "売上計上確定可能フラグ"
              }
            },
            {
              "ResultPropertyName": "R_仕入計上確定可能フラグ",
              "ResultTo": {
                "SerializeProperty": "仕入計上確定可能フラグ"
              }
            },
            {
              "ResultPropertyName": "R_売上計上ステータスID",
              "ResultTo": {
                "SerializeProperty": "売上計上ステータスID"
              }
            },
            {
              "ResultPropertyName": "R_仕入計上ステータスID",
              "ResultTo": {
                "SerializeProperty": "仕入計上ステータスID"
              }
            },
            {
              "ResultPropertyName": "R_計上確定可能フラグ",
              "ResultTo": {
                "SerializeProperty": "計上確定可能フラグ"
              }
            }
          ],
          "RefreshAfterFinish": true,
          "CheckDataValidation": true
        },
        {
          "$type": "Forguncy.Model.UpdateDataTableCommand, ServerDesignerCommon",
          "TableName": "t_object_product",
          "ShowConfirm": false,
          "ConfirmText": "本当に更新してもよろしいですか？",
          "RowsToUpdate": 1,
          "RowsToUpdateCondition": {
            "$type": "ForguncyDataAccess.GeneralCESqlCondition, ForguncyDataAccess",
            "ColumnBindingInfo": {
              "TableName": "t_object_product",
              "ColumnName": "object_product_id"
            },
            "Value": {
              "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
              "SerializeProperty": "=Item.物件商品ID"
            }
          },
          "UpdateValues": [
            {
              "ColumnName": "sales_account_status_id",
              "Value": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=売上計上ステータスID"
              }
            },
            {
              "ColumnName": "purchase_account_status_id",
              "Value": {
                "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                "SerializeProperty": "=仕入計上ステータスID"
              }
            }
          ]
        },
        {
          "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
          "ConditionAndCommandPairList": [
            {
              "Condition": {
                "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                "param": {
                  "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                  "ParamObject": {
                    "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                    "SerializeProperty": "=売上計上確定可能フラグ"
                  }
                },
                "value": "1"
              },
              "CommandList": [
                {
                  "$type": "Forguncy.Model.RequestServerCommand, ServerDesignerCommon",
                  "ServerCommandName": "売上計上データ確定処理（物件商品ID）",
                  "Parameters": [
                    {
                      "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
                      "Value": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=Item.物件商品ID"
                      },
                      "ParamName": "P_物件商品ID"
                    }
                  ],
                  "ResultErrorCodeTo": {
                    "SerializeProperty": "リターンコード"
                  },
                  "ResultMessageTo": {
                    "SerializeProperty": "リターンメッセージ"
                  },
                  "RefreshAfterFinish": true,
                  "CheckDataValidation": true
                },
                {
                  "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
                  "ConditionAndCommandPairList": [
                    {
                      "Condition": {
                        "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                        "param": {
                          "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                          "ParamObject": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=リターンコード"
                          }
                        },
                        "value": "0",
                        "compareType": 1
                      },
                      "CommandList": [
                        {
                          "$type": "Forguncy.Model.ReturnCommand, ServerDesignerCommon",
                          "ErrorCode": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=リターンコード"
                          },
                          "Message": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=リターンメッセージ"
                          },
                          "CustomReturns": []
                        }
                      ],
                      "ID": "95b766f0-ecf8-44d3-a0d9-7cd0b2ff8b94"
                    }
                  ]
                }
              ],
              "ID": "cda6b937-001b-4c01-9bf3-da39a8a5c2d3"
            }
          ]
        },
        {
          "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
          "ConditionAndCommandPairList": [
            {
              "Condition": {
                "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                "param": {
                  "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                  "ParamObject": {
                    "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                    "SerializeProperty": "=仕入計上確定可能フラグ"
                  }
                },
                "value": "1"
              },
              "CommandList": [
                {
                  "$type": "Forguncy.Model.RequestServerCommand, ServerDesignerCommon",
                  "ServerCommandName": "仕入計上データ確定処理（物件商品ID）",
                  "Parameters": [
                    {
                      "$type": "Forguncy.Model.RequestServerCommandObjectParam, ServerDesignerCommon",
                      "Value": {
                        "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                        "SerializeProperty": "=Item.物件商品ID"
                      },
                      "ParamName": "P_物件商品ID"
                    }
                  ],
                  "ResultErrorCodeTo": {
                    "SerializeProperty": "リターンコード"
                  },
                  "ResultMessageTo": {
                    "SerializeProperty": "リターンメッセージ"
                  },
                  "RefreshAfterFinish": true,
                  "CheckDataValidation": true
                },
                {
                  "$type": "Forguncy.Model.ConditionCommand, ServerDesignerCommon",
                  "ConditionAndCommandPairList": [
                    {
                      "Condition": {
                        "$type": "Forguncy.Model.IfCondition, ServerDesignerCommon",
                        "param": {
                          "$type": "Forguncy.Model.IfConditionServerSiteParam, ServerDesignerCommon",
                          "ParamObject": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=リターンコード"
                          }
                        },
                        "value": "0",
                        "compareType": 1
                      },
                      "CommandList": [
                        {
                          "$type": "Forguncy.Model.ReturnCommand, ServerDesignerCommon",
                          "ErrorCode": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=リターンコード"
                          },
                          "Message": {
                            "$type": "Forguncy.Model.FormulaReferObject, ServerDesignerCommon",
                            "SerializeProperty": "=リターンメッセージ"
                          },
                          "CustomReturns": []
                        }
                      ],
                      "ID": "9e3bfd05-7127-43c8-8c54-b6ce43337bc7"
                    }
                  ]
                }
              ],
              "ID": "496255b5-ae7e-443b-859d-f94458771eb3"
            }
          ]
        }
      ],
      "Comments": "転圧商品を確定する"
    },
    {
      "$type": "Forguncy.Model.ReturnCommand, ServerDesignerCommon",
      "ErrorCode": "0",
      "CustomReturns": []
    }
  ],
  "Name": "転圧商品確定処理"
}